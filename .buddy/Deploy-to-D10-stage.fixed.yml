- pipeline: deploy-to-d10-stage
  name: Deploy to D10 stage
  refs:
  - refs/heads/main
  events:
  - type: WEBHOOK
  - type: PUSH
  fail_on_prepare_env_warning: true
  targets:
  - target: d10-kocsibeallo-stage
    type: SSH
    name: D10 kocsibeallo stage
    host: 159.223.220.3
    auth:
      username: kocsid10ssh
      password: '!encrypted wQENVMUwrOn/5KmvjUq9nQ==.wcNHjVrP368JjXwCoJZIiQ=='
  actions:
  - action: Execute git restore web/themes/contrib/porto_theme
    type: SSH_COMMAND
    commands:
    - cd ~/public_html
    - git stash
    - git pull origin main
    - git stash pop
    - git status web/themes/contrib/porto_theme
    - git restore web/themes/contrib/porto_theme
    targets:
    - d10-kocsibeallo-stage
    run_as_script: true
  - action: Execute fi
    type: SSH_COMMAND
    commands:
    - cd ~/public_html
    - ""
    - "# Check if needed"
    - "if [ ! -f vendor/autoload.php ]; then"
    - '  composer install --no-dev --optimize-autoloader'
    - fi
    targets:
    - d10-kocsibeallo-stage
    run_as_script: true
  - action: Execute chmod -R 755 .
    type: SSH_COMMAND
    commands:
    - cd ~/public_html/web/sites/default/files
    - ""
    - rsync -avz --progress \
    - '  kocsibeall.ssh.d10@165.22.200.254:/home/969836.cloudwaysapps.com/pajfrsyfzm/public_html/sites/default/files/ \'
    - '  ./'
    - ""
    - "# Set permissions"
    - chmod -R 755 .
    targets:
    - d10-kocsibeallo-stage
    run_as_script: true
